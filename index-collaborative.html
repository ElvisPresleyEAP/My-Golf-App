<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Player Golf Scorecard by Kamal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase configuration (using a demo config - you'll want your own)
        const firebaseConfig = {
            apiKey: "AIzaSyDemoKey-ReplaceWithYourOwnFirebaseConfig",
            authDomain: "golf-scorecard-demo.firebaseapp.com",
            databaseURL: "https://golf-scorecard-demo-default-rtdb.firebaseio.com/",
            projectId: "golf-scorecard-demo",
            storageBucket: "golf-scorecard-demo.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456789"
        };

        // For demo purposes, we'll use a simple object-based sync instead of Firebase
        // In production, you'd use Firebase with the config above
        const SyncManager = {
            listeners: new Set(),
            data: JSON.parse(localStorage.getItem('golfScorecardShared') || 'null'),
            
            subscribe(callback) {
                this.listeners.add(callback);
                return () => this.listeners.delete(callback);
            },
            
            update(newData) {
                this.data = { ...this.data, ...newData };
                localStorage.setItem('golfScorecardShared', JSON.stringify(this.data));
                // Simulate network delay
                setTimeout(() => {
                    this.listeners.forEach(callback => callback(this.data));
                }, 100);
            },
            
            getCurrentData() {
                return this.data;
            },
            
            clear() {
                this.data = null;
                localStorage.removeItem('golfScorecardShared');
                this.listeners.forEach(callback => callback(null));
            }
        };

        const App = () => {
            // Initial data for holes
            const initialHoles = [
                { no: 1, par: 4, index: 16 }, { no: 2, par: 3, index: 10 }, { no: 3, par: 4, index: 4 },
                { no: 4, par: 4, index: 6 }, { no: 5, par: 4, index: 14 }, { no: 6, par: 4, index: 2 },
                { no: 7, par: 5, index: 8 }, { no: 8, par: 3, index: 12 }, { no: 9, par: 4, index: 18 },
                { no: 10, par: 4, index: 5 }, { no: 11, par: 4, index: 7 }, { no: 12, par: 5, index: 17 },
                { no: 13, par: 4, index: 1 }, { no: 14, par: 3, index: 13 }, { no: 15, par: 4, index: 9 },
                { no: 16, par: 5, index: 15 }, { no: 17, par: 3, index: 11 }, { no: 18, par: 4, index: 3 }
            ];

            // Game session management
            const [gameId, setGameId] = useState(localStorage.getItem('currentGameId') || '');
            const [isConnected, setIsConnected] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(null);
            const updateTimeoutRef = useRef(null);

            // Load initial data
            const savedData = SyncManager.getCurrentData();
            
            // State variables
            const [clubName, setClubName] = useState(savedData?.clubName || 'Letchworth Golf Club');
            const [players, setPlayers] = useState(savedData?.players || ['Player 1', 'Player 2', 'Player 3', 'Player 4']);
            const [playerHandicaps, setPlayerHandicaps] = useState(savedData?.playerHandicaps || [0, 0, 0, 0]);
            const [scores, setScores] = useState(savedData?.scores || Array(18).fill(null).map(() => Array(4).fill('')));
            const [points, setPoints] = useState(Array(18).fill(null).map(() => Array(4).fill('')));
            const [activeTab, setActiveTab] = useState('scorecard');

            const scorecardTitle = 'Multi-Player Golf Scorecard by Kamal';

            // Generate random game ID
            const generateGameId = () => {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            };

            // Join or create game session
            const joinGame = (id) => {
                const finalId = id || generateGameId();
                setGameId(finalId);
                localStorage.setItem('currentGameId', finalId);
                setIsConnected(true);
            };

            // Sync data to all devices
            const syncData = (newData) => {
                if (gameId && isConnected) {
                    clearTimeout(updateTimeoutRef.current);
                    updateTimeoutRef.current = setTimeout(() => {
                        SyncManager.update({
                            ...newData,
                            gameId,
                            lastUpdate: Date.now()
                        });
                        setLastUpdate(new Date().toLocaleTimeString());
                    }, 300); // Debounce updates
                }
            };

            // Subscribe to real-time updates
            useEffect(() => {
                if (!gameId) return;

                const unsubscribe = SyncManager.subscribe((data) => {
                    if (data && data.gameId === gameId) {
                        setClubName(data.clubName || 'Letchworth Golf Club');
                        setPlayers(data.players || ['Player 1', 'Player 2', 'Player 3', 'Player 4']);
                        setPlayerHandicaps(data.playerHandicaps || [0, 0, 0, 0]);
                        setScores(data.scores || Array(18).fill(null).map(() => Array(4).fill('')));
                        setLastUpdate(new Date(data.lastUpdate).toLocaleTimeString());
                    }
                });

                setIsConnected(true);
                return unsubscribe;
            }, [gameId]);

            // Calculate totals
            const playerGrossTotals = players.map((_, playerIndex) =>
                scores.reduce((acc, holeScores) => {
                    const score = holeScores[playerIndex];
                    return acc + (parseInt(score, 10) || 0);
                }, 0)
            );

            const playerPointTotals = players.map((_, playerIndex) =>
                points.reduce((acc, holePoints) => acc + (holePoints[playerIndex] || 0), 0)
            );

            const playerCountbackPointTotals = players.map((_, playerIndex) =>
                points.slice(12, 18).reduce((acc, holePoints) => acc + (holePoints[playerIndex] || 0), 0)
            );

            // Par totals
            const totalPar = initialHoles.reduce((acc, hole) => acc + hole.par, 0);
            const front9Par = initialHoles.slice(0, 9).reduce((acc, hole) => acc + hole.par, 0);
            const back9Par = initialHoles.slice(9, 18).reduce((acc, hole) => acc + hole.par, 0);

            // Calculate points when scores change
            useEffect(() => {
                const newPoints = initialHoles.map((hole, holeIndex) => {
                    return players.map((_, playerIndex) => {
                        const grossScore = scores[holeIndex][playerIndex];
                        const handicap = playerHandicaps[playerIndex] || 0;
                        const index = hole.index;
                        
                        if (grossScore === '') return '';
                        
                        const numericGrossScore = parseInt(grossScore, 10);
                        let strokes = 0;
                        
                        if (handicap > 0) {
                            strokes = Math.floor(handicap / 18) + (index <= (handicap % 18) ? 1 : 0);
                        }
                        
                        const nettStrokes = numericGrossScore - strokes;
                        const diff = nettStrokes - hole.par;
                        
                        let pts = 0;
                        if (diff <= -2) pts = 4;
                        else if (diff === -1) pts = 3;
                        else if (diff === 0) pts = 2;
                        else if (diff === 1) pts = 1;
                        else pts = 0;
                        
                        return pts;
                    });
                });
                setPoints(newPoints);
            }, [scores, players, playerHandicaps]);

            // Event handlers with sync
            const handlePlayerNameChange = (event, playerIndex) => {
                const newPlayers = [...players];
                newPlayers[playerIndex] = event.target.value;
                setPlayers(newPlayers);
                syncData({ players: newPlayers });
            };

            const handleHandicapChange = (event, playerIndex) => {
                const handicap = parseInt(event.target.value, 10);
                const newHandicaps = [...playerHandicaps];
                newHandicaps[playerIndex] = isNaN(handicap) ? 0 : handicap;
                setPlayerHandicaps(newHandicaps);
                syncData({ playerHandicaps: newHandicaps });
            };

            const handleScoreChange = (event, holeIndex, playerIndex) => {
                const score = event.target.value;
                const newScores = [...scores];
                newScores[holeIndex][playerIndex] = score;
                setScores(newScores);
                syncData({ scores: newScores });
            };

            const handleClubNameChange = (event) => {
                const newClubName = event.target.value;
                setClubName(newClubName);
                syncData({ clubName: newClubName });
            };

            const handleAddPlayer = () => {
                if (players.length >= 30) {
                    alert('Maximum of 30 players allowed');
                    return;
                }
                
                const newPlayers = [...players, `Player ${players.length + 1}`];
                const newHandicaps = [...playerHandicaps, 0];
                const newScores = scores.map(holeScores => [...holeScores, '']);
                
                setPlayers(newPlayers);
                setPlayerHandicaps(newHandicaps);
                setScores(newScores);
                
                syncData({ 
                    players: newPlayers, 
                    playerHandicaps: newHandicaps, 
                    scores: newScores 
                });
            };

            const handleRemovePlayer = (playerIndex) => {
                if (players.length <= 2) {
                    alert('Minimum of 2 players required');
                    return;
                }
                
                if (confirm(`Remove ${players[playerIndex]} from the scorecard?`)) {
                    const newPlayers = players.filter((_, index) => index !== playerIndex);
                    const newHandicaps = playerHandicaps.filter((_, index) => index !== playerIndex);
                    const newScores = scores.map(holeScores => 
                        holeScores.filter((_, index) => index !== playerIndex)
                    );
                    
                    setPlayers(newPlayers);
                    setPlayerHandicaps(newHandicaps);
                    setScores(newScores);
                    
                    syncData({ 
                        players: newPlayers, 
                        playerHandicaps: newHandicaps, 
                        scores: newScores 
                    });
                }
            };

            const resetScores = () => {
                if (confirm('Are you sure you want to reset all scores? This will clear all scores but keep player names and handicaps.')) {
                    const newScores = Array(18).fill(null).map(() => Array(players.length).fill(''));
                    setScores(newScores);
                    syncData({ scores: newScores });
                }
            };

            const clearAllData = () => {
                if (confirm('Are you sure you want to clear ALL data and end this game session?')) {
                    SyncManager.clear();
                    setGameId('');
                    setIsConnected(false);
                    localStorage.removeItem('currentGameId');
                    
                    // Reset to defaults
                    setClubName('Letchworth Golf Club');
                    setPlayers(['Player 1', 'Player 2', 'Player 3', 'Player 4']);
                    setPlayerHandicaps([0, 0, 0, 0]);
                    setScores(Array(18).fill(null).map(() => Array(4).fill('')));
                }
            };

            const shareViaWhatsApp = () => {
                let message = `${scorecardTitle}%0A${clubName}%0A%0A`;
                message += `üìã Final Scores:%0A`;
                
                players.forEach((player, index) => {
                    const totalGross = playerGrossTotals[index] || 0;
                    const totalPoints = playerPointTotals[index] || 0;
                    const handicap = playerHandicaps[index] || 0;
                    message += `${player} (HC: ${handicap}): ${totalGross} gross, ${totalPoints} points%0A`;
                });
                
                message += `%0ATotal Par: ${totalPar}%0A%0A‚õ≥ Powered by Multi-Player Golf Scorecard by Kamal`;
                
                const whatsappUrl = `https://wa.me/?text=${message}`;
                window.open(whatsappUrl, '_blank');
            };

            const emailScorecard = () => {
                let emailBody = `${scorecardTitle}\\n${clubName}\\n\\n`;
                emailBody += `üìã Final Scores:\\n`;
                
                players.forEach((player, index) => {
                    const totalGross = playerGrossTotals[index] || 0;
                    const totalPoints = playerPointTotals[index] || 0;
                    const handicap = playerHandicaps[index] || 0;
                    emailBody += `${player} (HC: ${handicap}): ${totalGross} gross, ${totalPoints} points\\n`;
                });
                
                emailBody += `\\nTotal Par: ${totalPar}\\n\\n‚õ≥ Powered by Multi-Player Golf Scorecard by Kamal`;
                
                const subject = encodeURIComponent(`Golf Scorecard - ${clubName}`);
                const body = encodeURIComponent(emailBody);
                const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
                
                try {
                    window.open(mailtoLink, '_self');
                } catch (error) {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(emailBody.replace(/\\n/g, '\\n'))
                            .then(() => alert('Scorecard copied to clipboard!'));
                    }
                }
            };

            // Game session UI
            if (!gameId || !isConnected) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-teal-100 to-green-100 p-8 flex items-center justify-center">
                        <div className="bg-white rounded-xl shadow-xl p-8 max-w-md w-full">
                            <h1 className="text-2xl font-bold text-center text-teal-700 mb-6">
                                üèåÔ∏è‚Äç‚ôÇÔ∏è Multi-Player Golf Scorecard
                            </h1>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        Join Existing Game
                                    </label>
                                    <div className="flex space-x-2">
                                        <input
                                            type="text"
                                            placeholder="Enter Game ID (e.g. ABC123)"
                                            value={gameId}
                                            onChange={(e) => setGameId(e.target.value.toUpperCase())}
                                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                        />
                                        <button
                                            onClick={() => joinGame(gameId)}
                                            disabled={!gameId.trim()}
                                            className="bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 text-white font-bold py-3 px-6 rounded-lg transition-colors"
                                        >
                                            Join
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="text-center">
                                    <div className="text-gray-400 text-sm mb-2">or</div>
                                    <button
                                        onClick={() => joinGame()}
                                        className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors"
                                    >
                                        üéÆ Create New Game
                                    </button>
                                </div>
                            </div>
                            
                            <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h3 className="font-semibold text-blue-800 mb-2">üì± How it works:</h3>
                                <ul className="text-sm text-blue-700 space-y-1">
                                    <li>‚Ä¢ Share the Game ID with your playing partners</li>
                                    <li>‚Ä¢ Everyone can edit scores in real-time</li>
                                    <li>‚Ä¢ Changes sync instantly across all devices</li>
                                    <li>‚Ä¢ Perfect for group play on the course!</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-100 p-4 md:p-8 font-sans antialiased text-gray-800">
                    {/* Connection Status Bar */}
                    <div className="max-w-7xl mx-auto mb-4">
                        <div className="bg-gradient-to-r from-teal-500 to-green-500 text-white p-3 rounded-lg flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="w-3 h-3 bg-green-300 rounded-full animate-pulse"></div>
                                <span className="font-semibold">Game ID: {gameId}</span>
                                <span className="text-green-200">‚Ä¢ Live Sync Active</span>
                            </div>
                            <div className="text-right text-sm">
                                {lastUpdate && <div>Last update: {lastUpdate}</div>}
                                <button 
                                    onClick={() => {
                                        navigator.clipboard.writeText(gameId);
                                        alert('Game ID copied to clipboard!');
                                    }}
                                    className="bg-white/20 hover:bg-white/30 px-3 py-1 rounded text-xs transition-colors"
                                >
                                    üìã Copy Game ID
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto mb-6">
                        <h1 className="w-full text-3xl md:text-4xl font-extrabold text-center text-teal-700 mb-2">
                            {scorecardTitle}
                        </h1>
                        <input
                            type="text"
                            value={clubName}
                            onChange={handleClubNameChange}
                            className="w-full text-xl text-center font-semibold text-gray-600 bg-transparent border-b-2 border-transparent focus:outline-none focus:border-gray-400 mb-2"
                        />
                        <p className="text-center text-gray-500">Gross scores + Stableford Points ‚Ä¢ Real-time Collaboration</p>
                        <p className="text-center text-green-600 text-xs mt-1">‚úì Synced across all devices</p>
                        
                        <div className="text-center mt-4">
                            <button
                                onClick={handleAddPlayer}
                                className="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 mr-2"
                                disabled={players.length >= 30}
                            >
                                + Add Player ({players.length}/30)
                            </button>
                        </div>
                        
                        {/* Tab Navigation */}
                        <div className="flex justify-center mt-6 border-b">
                            <button
                                onClick={() => setActiveTab('scorecard')}
                                className={`py-2 px-6 font-semibold border-b-2 transition-colors duration-300 ${
                                    activeTab === 'scorecard'
                                        ? 'border-teal-500 text-teal-600'
                                        : 'border-transparent text-gray-500 hover:text-gray-700'
                                }`}
                            >
                                üìã Scorecard
                            </button>
                            <button
                                onClick={() => setActiveTab('leaderboard')}
                                className={`py-2 px-6 font-semibold border-b-2 transition-colors duration-300 ${
                                    activeTab === 'leaderboard'
                                        ? 'border-teal-500 text-teal-600'
                                        : 'border-transparent text-gray-500 hover:text-gray-700'
                                }`}
                            >
                                üèÜ Leaderboard
                            </button>
                        </div>
                    </div>

                    {/* Scorecard Tab Content */}
                    {activeTab === 'scorecard' && (
                        <div className="max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-teal-600 text-white sticky top-0">
                                    <tr className="text-sm uppercase font-semibold">
                                        <th rowSpan="2" className="py-3 px-2 md:px-4 text-center">Hole</th>
                                        <th rowSpan="2" className="py-3 px-2 md:px-4 text-center">Par</th>
                                        <th rowSpan="2" className="py-3 px-2 md:px-4 text-center">Index</th>
                                        {players.map((_, index) => (
                                            <th key={index} colSpan="2" className="py-3 px-2 md:px-4 text-center relative">
                                                <input
                                                    type="text"
                                                    value={players[index]}
                                                    onChange={(e) => handlePlayerNameChange(e, index)}
                                                    className="w-full text-center bg-transparent border-b-2 border-white focus:outline-none focus:border-teal-200 pr-6"
                                                />
                                                {players.length > 2 && (
                                                    <button
                                                        onClick={() => handleRemovePlayer(index)}
                                                        className="absolute right-1 top-2 text-red-200 hover:text-red-100 font-bold text-sm"
                                                        title="Remove player"
                                                    >
                                                        √ó
                                                    </button>
                                                )}
                                            </th>
                                        ))}
                                    </tr>
                                    <tr>
                                        {players.map((_, index) => (
                                            <React.Fragment key={index}>
                                                <th className="py-3 px-2 md:px-4 text-center">Gross</th>
                                                <th className="py-3 px-2 md:px-4 text-center">Points</th>
                                            </React.Fragment>
                                        ))}
                                    </tr>
                                    <tr className="bg-teal-700 text-white text-xs">
                                        <th colSpan="3" className="py-1 px-2 md:px-4 text-center">Handicap (PHC)</th>
                                        {playerHandicaps.slice(0, players.length).map((handicap, index) => (
                                            <th key={index} colSpan="2" className="py-1 px-2 md:px-4">
                                                <input
                                                    type="number"
                                                    min="0"
                                                    value={handicap}
                                                    onChange={(e) => handleHandicapChange(e, index)}
                                                    className="w-full text-center bg-transparent border-b-2 border-white focus:outline-none focus:border-teal-200"
                                                />
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody>
                                    {/* Front 9 holes */}
                                    {initialHoles.slice(0, 9).map((hole, holeIndex) => (
                                        <tr key={hole.no} className="border-t border-gray-200 hover:bg-gray-50">
                                            <td className="py-2 px-2 md:px-4 text-center font-medium">{hole.no}</td>
                                            <td className="py-2 px-2 md:px-4 text-center">{hole.par}</td>
                                            <td className="py-2 px-2 md:px-4 text-center">{hole.index}</td>
                                            {players.map((_, playerIndex) => (
                                                <React.Fragment key={playerIndex}>
                                                    <td className="py-2 px-2 md:px-4">
                                                        <input
                                                            type="number"
                                                            min="1"
                                                            value={scores[holeIndex][playerIndex]}
                                                            onChange={(e) => handleScoreChange(e, holeIndex, playerIndex)}
                                                            className="w-full p-2 text-center border rounded-md focus:ring-2 focus:ring-teal-300"
                                                        />
                                                    </td>
                                                    <td className="py-2 px-2 md:px-4 text-center font-bold">
                                                        {points[holeIndex] && points[holeIndex][playerIndex] !== undefined ? points[holeIndex][playerIndex] : ''}
                                                    </td>
                                                </React.Fragment>
                                            ))}
                                        </tr>
                                    ))}
                                    
                                    {/* Front 9 total */}
                                    <tr className="bg-blue-50 border-t-2 border-blue-400 font-bold">
                                        <td colSpan="2" className="py-2 px-2 md:px-4 text-center text-blue-700">Out (Front 9)</td>
                                        <td className="py-2 px-2 md:px-4 text-center text-blue-700">{front9Par}</td>
                                        {players.map((_, playerIndex) => {
                                            const front9Gross = scores.slice(0, 9).reduce((acc, holeScores) => {
                                                const score = holeScores[playerIndex];
                                                return acc + (parseInt(score, 10) || 0);
                                            }, 0);
                                            const front9Points = points.slice(0, 9).reduce((acc, holePoints) => {
                                                const point = holePoints && holePoints[playerIndex];
                                                return acc + (point || 0);
                                            }, 0);
                                            return (
                                                <React.Fragment key={playerIndex}>
                                                    <td className="py-2 px-2 md:px-4 text-center text-blue-700">{front9Gross || ''}</td>
                                                    <td className="py-2 px-2 md:px-4 text-center text-blue-700">{front9Points || ''}</td>
                                                </React.Fragment>
                                            );
                                        })}
                                    </tr>

                                    {/* Back 9 holes */}
                                    {initialHoles.slice(9, 18).map((hole, holeIndex) => {
                                        const actualIndex = holeIndex + 9;
                                        return (
                                            <tr key={hole.no} className="border-t border-gray-200 hover:bg-gray-50">
                                                <td className="py-2 px-2 md:px-4 text-center font-medium">{hole.no}</td>
                                                <td className="py-2 px-2 md:px-4 text-center">{hole.par}</td>
                                                <td className="py-2 px-2 md:px-4 text-center">{hole.index}</td>
                                                {players.map((_, playerIndex) => (
                                                    <React.Fragment key={playerIndex}>
                                                        <td className="py-2 px-2 md:px-4">
                                                            <input
                                                                type="number"
                                                                min="1"
                                                                value={scores[actualIndex][playerIndex]}
                                                                onChange={(e) => handleScoreChange(e, actualIndex, playerIndex)}
                                                                className="w-full p-2 text-center border rounded-md focus:ring-2 focus:ring-teal-300"
                                                            />
                                                        </td>
                                                        <td className="py-2 px-2 md:px-4 text-center font-bold">
                                                            {points[actualIndex] && points[actualIndex][playerIndex] !== undefined ? points[actualIndex][playerIndex] : ''}
                                                        </td>
                                                    </React.Fragment>
                                                ))}
                                            </tr>
                                        );
                                    })}
                                    
                                    {/* Back 9 total */}
                                    <tr className="bg-green-50 border-t-2 border-green-400 font-bold">
                                        <td colSpan="2" className="py-2 px-2 md:px-4 text-center text-green-700">In (Back 9)</td>
                                        <td className="py-2 px-2 md:px-4 text-center text-green-700">{back9Par}</td>
                                        {players.map((_, playerIndex) => {
                                            const back9Gross = scores.slice(9, 18).reduce((acc, holeScores) => {
                                                const score = holeScores[playerIndex];
                                                return acc + (parseInt(score, 10) || 0);
                                            }, 0);
                                            const back9Points = points.slice(9, 18).reduce((acc, holePoints) => {
                                                const point = holePoints && holePoints[playerIndex];
                                                return acc + (point || 0);
                                            }, 0);
                                            return (
                                                <React.Fragment key={playerIndex}>
                                                    <td className="py-2 px-2 md:px-4 text-center text-green-700">{back9Gross || ''}</td>
                                                    <td className="py-2 px-2 md:px-4 text-center text-green-700">{back9Points || ''}</td>
                                                </React.Fragment>
                                            );
                                        })}
                                    </tr>
                                    
                                    {/* Countback row */}
                                    <tr className="bg-gray-200 border-t-2 border-gray-400 font-bold">
                                        <td colSpan="3" className="py-2 px-2 md:px-4 text-center text-gray-700">Countback (Holes 13-18)</td>
                                        {players.map((_, playerIndex) => (
                                            <React.Fragment key={playerIndex}>
                                                <td className="py-2 px-2 md:px-4 text-center"></td>
                                                <td className="py-2 px-2 md:px-4 text-center text-gray-700">{playerCountbackPointTotals[playerIndex] || ''}</td>
                                            </React.Fragment>
                                        ))}
                                    </tr>
                                    
                                    {/* Total row */}
                                    <tr className="bg-teal-50 border-t-2 border-teal-600 font-bold">
                                        <td colSpan="2" className="py-3 px-2 md:px-4 text-center">Total</td>
                                        <td className="py-3 px-2 md:px-4 text-center">{totalPar}</td>
                                        {playerGrossTotals.slice(0, players.length).map((total, index) => (
                                            <React.Fragment key={index}>
                                                <td className="py-3 px-2 md:px-4 text-center text-teal-800">{total}</td>
                                                <td className="py-3 px-2 md:px-4 text-center"></td>
                                            </React.Fragment>
                                        ))}
                                    </tr>
                                    <tr className="bg-teal-50 border-t border-gray-200 font-bold">
                                        <td colSpan="3" className="py-3 px-2 md:px-4 text-center text-sm">Total Points</td>
                                        {playerPointTotals.slice(0, players.length).map((total, index) => (
                                            <React.Fragment key={index}>
                                                <td className="py-3 px-2 md:px-4 text-center"></td>
                                                <td className="py-3 px-2 md:px-4 text-center text-teal-800">{total}</td>
                                            </React.Fragment>
                                        ))}
                                    </tr>
                                </tbody>
                            </table>
                            
                            {/* Action Buttons */}
                            <div className="bg-gray-50 px-6 py-4 border-t">
                                <div className="flex flex-wrap justify-center gap-3 mb-4">
                                    <button
                                        onClick={resetScores}
                                        className="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 flex items-center gap-2"
                                    >
                                        üîÑ Reset Scores
                                    </button>
                                    <button
                                        onClick={clearAllData}
                                        className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 flex items-center gap-2"
                                    >
                                        üóëÔ∏è End Game Session
                                    </button>
                                </div>
                                <div className="flex flex-wrap justify-center gap-3">
                                    <button
                                        onClick={emailScorecard}
                                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 flex items-center gap-2"
                                    >
                                        üìß Email Scorecard
                                    </button>
                                    <button
                                        onClick={shareViaWhatsApp}
                                        className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 flex items-center gap-2"
                                    >
                                        üí¨ Share via WhatsApp
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Leaderboard Tab Content */}
                    {activeTab === 'leaderboard' && (
                        <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
                            <div className="bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 p-6">
                                <h2 className="text-2xl font-bold text-center text-white mb-2">
                                    üèÜ Live Leaderboard
                                </h2>
                                <p className="text-center text-yellow-100 text-sm">
                                    Ranked by Total Stableford Points ‚Ä¢ Updates in Real-time
                                </p>
                            </div>
                            
                            <div className="p-6">
                                {players
                                    .map((player, index) => ({
                                        name: player,
                                        playerIndex: index,
                                        totalPoints: playerPointTotals[index] || 0,
                                        totalGross: playerGrossTotals[index] || 0,
                                        handicap: playerHandicaps[index] || 0,
                                        countbackPoints: playerCountbackPointTotals[index] || 0,
                                        front9Points: points.slice(0, 9).reduce((acc, holePoints) => {
                                            const point = holePoints && holePoints[index];
                                            return acc + (point || 0);
                                        }, 0),
                                        back9Points: points.slice(9, 18).reduce((acc, holePoints) => {
                                            const point = holePoints && holePoints[index];
                                            return acc + (point || 0);
                                        }, 0)
                                    }))
                                    .sort((a, b) => {
                                        if (b.totalPoints !== a.totalPoints) {
                                            return b.totalPoints - a.totalPoints;
                                        }
                                        if (b.countbackPoints !== a.countbackPoints) {
                                            return b.countbackPoints - a.countbackPoints;
                                        }
                                        return a.totalGross - b.totalGross;
                                    })
                                    .map((playerData, position) => {
                                        const isWinner = position === 0;
                                        const isRunner = position === 1;
                                        const isThird = position === 2;
                                        
                                        return (
                                            <div 
                                                key={playerData.playerIndex} 
                                                className={`mb-4 p-4 rounded-lg border-2 transition-all duration-300 hover:shadow-md ${
                                                    isWinner 
                                                        ? 'bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-400 shadow-lg'
                                                        : isRunner
                                                        ? 'bg-gradient-to-r from-gray-50 to-gray-100 border-gray-400'
                                                        : isThird
                                                        ? 'bg-gradient-to-r from-orange-50 to-orange-100 border-orange-400'
                                                        : 'bg-gray-50 border-gray-200'
                                                }`}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center space-x-4">
                                                        <div className={`text-2xl font-bold w-12 h-12 rounded-full flex items-center justify-center ${
                                                            isWinner 
                                                                ? 'bg-yellow-400 text-yellow-800'
                                                                : isRunner
                                                                ? 'bg-gray-400 text-gray-800'
                                                                : isThird
                                                                ? 'bg-orange-400 text-orange-800'
                                                                : 'bg-gray-300 text-gray-700'
                                                        }`}>
                                                            {isWinner ? 'ü•á' : isRunner ? 'ü•à' : isThird ? 'ü•â' : position + 1}
                                                        </div>
                                                        <div>
                                                            <h3 className={`text-lg font-bold ${
                                                                isWinner ? 'text-yellow-800' : 'text-gray-800'
                                                            }`}>
                                                                {playerData.name}
                                                                {isWinner && ' üèÜ'}
                                                            </h3>
                                                            <p className="text-sm text-gray-600">
                                                                Handicap: {playerData.handicap}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="text-right">
                                                        <div className={`text-2xl font-bold ${
                                                            isWinner ? 'text-yellow-600' : 'text-gray-700'
                                                        }`}>
                                                            {playerData.totalPoints} pts
                                                        </div>
                                                        <div className="text-sm text-gray-500">
                                                            Points: {playerData.totalPoints}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div className="mt-3 pt-3 border-t border-gray-200">
                                                    <div className="grid grid-cols-3 gap-4 text-sm">
                                                        <div className="text-center">
                                                            <span className="block text-blue-600 font-semibold">
                                                                {playerData.front9Points} pts
                                                            </span>
                                                            <span className="text-gray-500">Front 9</span>
                                                        </div>
                                                        <div className="text-center">
                                                            <span className="block text-green-600 font-semibold">
                                                                {playerData.back9Points} pts
                                                            </span>
                                                            <span className="text-gray-500">Back 9</span>
                                                        </div>
                                                        <div className="text-center">
                                                            <span className="block text-purple-600 font-semibold">
                                                                {playerData.countbackPoints} pts
                                                            </span>
                                                            <span className="text-gray-500">Countback</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                            </div>
                            
                            <div className="bg-gray-50 px-6 py-4 border-t">
                                <p className="text-center text-gray-600 text-sm">
                                    ‚ÑπÔ∏è Live updates ‚Ä¢ Tiebreaker: 1) Total Points 2) Countback Points 3) Lowest Gross Score
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
